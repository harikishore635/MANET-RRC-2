{
  "title": "OLSR JSON Interface Specification",
  "description": "JSON format for RRC to OLSR communication on ZCU104 A53/R5 bare metal",
  "version": "1.0",
  "platform": "ZCU104 Zynq UltraScale+",
  "cores": ["A53 Application Processor", "R5 Real-time Processor"],
  
  "communication_method": {
    "options": [
      "Shared memory between A53 and R5",
      "Message passing via OCM (On-Chip Memory)",
      "Inter-processor interrupts (IPI)",
      "Custom mailbox implementation"
    ],
    "recommended": "Shared memory with semaphore synchronization"
  },

  "json_messages": {
    "route_request": {
      "description": "RRC requests route from OLSR when link quality changes",
      "format": {
        "type": "route_request",
        "source_node": 254,
        "dest_node": 1,
        "timestamp": 1697875200,
        "link_metrics": {
          "rssi_dbm": -75.5,
          "snr_db": 12.3,
          "per_percent": 3.2
        },
        "request_id": 12345,
        "priority": 0,
        "urgency": "normal|high|emergency"
      },
      "trigger_conditions": [
        "RSSI change > 5dB",
        "SNR change > 3dB", 
        "PER change > 5%",
        "No route available",
        "Route timeout (30 seconds)"
      ]
    },

    "topology_update": {
      "description": "RRC sends neighbor link quality updates to OLSR",
      "format": {
        "type": "topology_update",
        "reporting_node": 254,
        "timestamp": 1697875200,
        "neighbors": [
          {
            "node_id": 1,
            "link_quality": 0.85,
            "rssi_dbm": -70.5,
            "snr_db": 15.2,
            "per_percent": 2.1,
            "link_active": true,
            "last_seen": 1697875190
          },
          {
            "node_id": 2,
            "link_quality": 0.62,
            "rssi_dbm": -82.1,
            "snr_db": 12.8,
            "per_percent": 4.3,
            "link_active": true,
            "last_seen": 1697875195
          }
        ]
      }
    },

    "route_response": {
      "description": "OLSR responds with routing decision to RRC",
      "format": {
        "type": "route_response",
        "source_node": 254,
        "dest_node": 1,
        "next_hop": 2,
        "hop_count": 2,
        "link_quality": 0.78,
        "route_metric": 1.5,
        "route_valid": true,
        "route_lifetime": 300,
        "sequence_number": 42,
        "route_table": [
          {"dest": 1, "next_hop": 2, "metric": 1.5, "hops": 2},
          {"dest": 3, "next_hop": 1, "metric": 2.1, "hops": 3},
          {"dest": 4, "next_hop": 4, "metric": 1.0, "hops": 1}
        ]
      }
    },

    "link_state_update": {
      "description": "Emergency link failure notification",
      "format": {
        "type": "link_state_update",
        "reporting_node": 254,
        "failed_neighbor": 2,
        "timestamp": 1697875200,
        "failure_reason": "rssi_threshold|timeout|per_threshold",
        "last_rssi": -95.0,
        "affected_routes": [1, 3, 5]
      }
    }
  },

  "data_types_from_rrc": {
    "RRC_DATA_TYPE_SMS": 0,
    "RRC_DATA_TYPE_VOICE": 1,
    "RRC_DATA_TYPE_VIDEO": 2,
    "RRC_DATA_TYPE_FILE": 3,
    "RRC_DATA_TYPE_RELAY": 4
  },

  "priority_levels": {
    "PRIORITY_ANALOG_VOICE_PTT": -1,
    "PRIORITY_DIGITAL_VOICE": 0,
    "PRIORITY_VIDEO": 1,
    "PRIORITY_FILE": 2,
    "PRIORITY_SMS": 3,
    "PRIORITY_RX_RELAY": 4
  },

  "thresholds": {
    "rssi_active_threshold": -85.0,
    "snr_active_threshold": 10.0,
    "per_active_threshold": 10.0,
    "rssi_change_trigger": 5.0,
    "snr_change_trigger": 3.0,
    "per_change_trigger": 5.0,
    "route_timeout_seconds": 30
  },

  "implementation_notes": {
    "memory_location": "Define shared memory region in ZCU104 DDR4",
    "synchronization": "Use semaphores or mutex for thread safety",
    "json_size_limit": "512 bytes per message (embedded constraints)",
    "update_frequency": "Link quality updates every 1 second",
    "emergency_handling": "PTT messages trigger immediate route requests"
  },

  "sample_code_integration": {
    "c_struct_example": "typedef struct { char json_buffer[512]; uint32_t length; uint32_t timestamp; } olsr_message_t;",
    "shared_memory": "olsr_message_t* olsr_mailbox = (olsr_message_t*)OLSR_SHARED_MEM_BASE;",
    "parsing": "Use cJSON library or custom parser for JSON handling"
  }
}